!function(){"use strict";let e,t,r={};const n=[[-1,1,e=>{t=e}],[0,1,e=>{t=e}],[1,1,e=>{t=e}],[1,4,(e,r,n,s)=>{t=["subscript",[e,n]]}],[2,1,e=>{t=e}],[2,3,(e,r,n)=>{t=["method",[e,[]]]}],[2,4,(e,r,n,s)=>{t=["method",[e,n]]}],[3,1,e=>{t=e}],[3,3,(e,r,n)=>{t=["access",[e,n]]}],[4,3,(e,r,n)=>{t=r}],[4,1,e=>{t=e}],[4,1,e=>{t=e}],[5,1,e=>{t=["id",e]}],[6,1,e=>{t=["val",e,"'"]}],[6,1,e=>{t=["val",e,'"']}],[6,1,e=>{t=["val",parseInt(e)]}],[6,1,e=>{t=["val",parseFloat(e)]}],[6,1,e=>{t=["val",!0]}],[6,1,e=>{t=["val",!1]}],[6,1,e=>{t=["val",null]}],[6,3,(e,r,n)=>{t=["val",r]}],[6,2,(e,r)=>{t=["val",[]]}],[7,1,e=>{t=[e]}],[7,3,(e,r,n)=>{e.push(n),t=e}]],s={LBRACKET:"8",RBRACKET:"9",LPAREN:"10",RPAREN:"11",DOT:"12",IDENTIFIER:"13",STRING1:"14",STRING2:"15",INT:"16",FLOAT:"17",TRUE:"18",FALSE:"19",NULL:"20",COMMA:"21",$:"22"},o=[{0:1,1:2,2:3,3:4,4:5,5:8,6:7,8:"s16",10:"s6",13:"s17",14:"s9",15:"s10",16:"s11",17:"s12",18:"s13",19:"s14",20:"s15"},{22:"acc"},{8:"s18",9:"r1",11:"r1",12:"s19",21:"r1",22:"r1"},{8:"r2",9:"r2",10:"s22",11:"r2",12:"r2",21:"r2",22:"r2"},{8:"r4",9:"r4",10:"r4",11:"r4",12:"r4",21:"r4",22:"r4"},{8:"r7",9:"r7",10:"r7",11:"r7",12:"r7",21:"r7",22:"r7"},{0:29,1:2,2:3,3:4,4:5,5:8,6:7,8:"s16",10:"s6",13:"s17",14:"s9",15:"s10",16:"s11",17:"s12",18:"s13",19:"s14",20:"s15"},{8:"r10",9:"r10",10:"r10",11:"r10",12:"r10",21:"r10",22:"r10"},{8:"r11",9:"r11",10:"r11",11:"r11",12:"r11",21:"r11",22:"r11"},{8:"r13",9:"r13",10:"r13",11:"r13",12:"r13",21:"r13",22:"r13"},{8:"r14",9:"r14",10:"r14",11:"r14",12:"r14",21:"r14",22:"r14"},{8:"r15",9:"r15",10:"r15",11:"r15",12:"r15",21:"r15",22:"r15"},{8:"r16",9:"r16",10:"r16",11:"r16",12:"r16",21:"r16",22:"r16"},{8:"r17",9:"r17",10:"r17",11:"r17",12:"r17",21:"r17",22:"r17"},{8:"r18",9:"r18",10:"r18",11:"r18",12:"r18",21:"r18",22:"r18"},{8:"r19",9:"r19",10:"r19",11:"r19",12:"r19",21:"r19",22:"r19"},{0:25,1:2,2:3,3:4,4:5,5:8,6:7,7:31,8:"s16",9:"s32",10:"s6",13:"s17",14:"s9",15:"s10",16:"s11",17:"s12",18:"s13",19:"s14",20:"s15"},{8:"r12",9:"r12",10:"r12",11:"r12",12:"r12",21:"r12",22:"r12"},{0:20,1:2,2:3,3:4,4:5,5:8,6:7,8:"s16",10:"s6",13:"s17",14:"s9",15:"s10",16:"s11",17:"s12",18:"s13",19:"s14",20:"s15"},{5:34,13:"s17"},{9:"s21"},{8:"r3",9:"r3",11:"r3",12:"r3",21:"r3",22:"r3"},{0:25,1:2,2:3,3:4,4:5,5:8,6:7,7:24,8:"s16",10:"s6",11:"s23",13:"s17",14:"s9",15:"s10",16:"s11",17:"s12",18:"s13",19:"s14",20:"s15"},{8:"r5",9:"r5",10:"r5",11:"r5",12:"r5",21:"r5",22:"r5"},{11:"s26",21:"s27"},{9:"r22",11:"r22",21:"r22"},{8:"r6",9:"r6",10:"r6",11:"r6",12:"r6",21:"r6",22:"r6"},{0:28,1:2,2:3,3:4,4:5,5:8,6:7,8:"s16",10:"s6",13:"s17",14:"s9",15:"s10",16:"s11",17:"s12",18:"s13",19:"s14",20:"s15"},{9:"r23",11:"r23",21:"r23"},{11:"s30"},{8:"r9",9:"r9",10:"r9",11:"r9",12:"r9",21:"r9",22:"r9"},{9:"s33",21:"s27"},{8:"r21",9:"r21",10:"r21",11:"r21",12:"r21",21:"r21",22:"r21"},{8:"r20",9:"r20",10:"r20",11:"r20",12:"r20",21:"r20",22:"r20"},{8:"r8",9:"r8",10:"r8",11:"r8",12:"r8",21:"r8",22:"r8"}],i=[];let l;const a=[[/^\s+/,function(){}],[/^\btrue\b/,function(){return"TRUE"}],[/^\bfalse\b/,function(){return"FALSE"}],[/^\bnull\b/,function(){return"NULL"}],[/^\(/,function(){return"LPAREN"}],[/^\)/,function(){return"RPAREN"}],[/^\[/,function(){return"LBRACKET"}],[/^\]/,function(){return"RBRACKET"}],[/^,/,function(){return"COMMA"}],[/^\d*\.\d+/,function(){return"FLOAT"}],[/^\d+/,function(){return"INT"}],[/^\./,function(){return"DOT"}],[/^[a-zA-Z0-9_]+/,function(){return"IDENTIFIER"}],[/^"(?:\\[\"\\]|[^\"\\])*"/,function(){return e=e.slice(1,-1),"STRING2"}],[/^'(?:\\[\'\\]|[^\'\\])*'/,function(){return e=e.slice(1,-1),"STRING1"}]],c={INITIAL:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]},u={type:"$",value:""};l={initString(e){return this._string=e,this._cursor=0,this._states=["INITIAL"],this._tokensQueue=[],this._currentLine=1,this._currentColumn=0,this._currentLineBeginOffset=0,this._tokenStartOffset=0,this._tokenEndOffset=0,this._tokenStartLine=1,this._tokenEndLine=1,this._tokenStartColumn=0,this._tokenEndColumn=0,this},getStates(){return this._states},getCurrentState(){return this._states[this._states.length-1]},pushState(e){this._states.push(e)},begin(e){this.pushState(e)},popState(){return this._states.length>1?this._states.pop():this._states[0]},getNextToken(){if(this._tokensQueue.length>0)return this.onToken(this._toToken(this._tokensQueue.shift()));if(!this.hasMoreTokens())return this.onToken(u);let t=this._string.slice(this._cursor),r=c[this.getCurrentState()];for(let n=0;n<r.length;n++){let s=r[n],o=a[s],i=this._match(t,o[0]);if(""===t&&""===i&&this._cursor++,null!==i){e=i;let t=o[1].call(this);if(!t)return this.getNextToken();if(Array.isArray(t)){const e=t.slice(1);t=t[0],e.length>0&&this._tokensQueue.unshift(...e)}return this.onToken(this._toToken(t,e))}}if(this.isEOF())return this._cursor++,u;this.throwUnexpectedToken(t[0],this._currentLine,this._currentColumn)},throwUnexpectedToken(e,t,r){const n=this._string.split("\n")[t-1];let s="";if(n){s="\n\n"+n+"\n"+" ".repeat(r)+"^\n"}throw new SyntaxError(`${s}Unexpected token: "${e}" at ${t}:${r}.`)},getCursor(){return this._cursor},getCurrentLine(){return this._currentLine},getCurrentColumn(){return this._currentColumn},_captureLocation(e){const t=/\n/g;let r;for(this._tokenStartOffset=this._cursor,this._tokenStartLine=this._currentLine,this._tokenStartColumn=this._tokenStartOffset-this._currentLineBeginOffset;null!==(r=t.exec(e));)this._currentLine++,this._currentLineBeginOffset=this._tokenStartOffset+r.index+1;this._tokenEndOffset=this._cursor+e.length,this._tokenEndLine=this._currentLine,this._tokenEndColumn=this._currentColumn=this._tokenEndOffset-this._currentLineBeginOffset},_toToken(e,t=""){return{type:e,value:t,startOffset:this._tokenStartOffset,endOffset:this._tokenEndOffset,startLine:this._tokenStartLine,endLine:this._tokenEndLine,startColumn:this._tokenStartColumn,endColumn:this._tokenEndColumn}},isEOF(){return this._cursor===this._string.length},hasMoreTokens(){return this._cursor<=this._string.length},_match(e,t){let r=e.match(t);return r?(this._captureLocation(r[0]),this._cursor+=r[0].length,r[0]):null},onToken:e=>e},r.lexer=l,r.tokenizer=l,r.options={captureLocations:!1};const d={setOptions(e){return r.options=e,this},getOptions:()=>r.options,parse(a,c){if(!l)throw new Error("Tokenizer instance wasn't specified.");l.initString(a);let u=r.options;c&&(r.options=Object.assign({},r.options,c)),i.length=0,i.push(0);let p=l.getNextToken(),g=null;do{p||(r.options=u,f());let a=i[i.length-1],c=s[p.type];o[a].hasOwnProperty(c)||(r.options=u,h(p));let m=o[a][c];if("s"===m[0]){let e=null;r.options.captureLocations&&(e={startOffset:p.startOffset,endOffset:p.endOffset,startLine:p.startLine,endLine:p.endLine,startColumn:p.startColumn,endColumn:p.endColumn}),g=this.onShift(p),i.push({symbol:s[g.type],semanticValue:g.value,loc:e},Number(m.slice(1))),p=l.getNextToken()}else if("r"===m[0]){let s=m.slice(1),l=n[s],a="function"==typeof l[2],c=a?[]:null;const u=a&&r.options.captureLocations?[]:null;if(0!==l[1]){let e=l[1];for(;e-- >0;){i.pop();let e=i.pop();a&&(c.unshift(e.semanticValue),u&&u.unshift(e.loc))}}const d={symbol:l[0]};if(a){e=g?g.value:null,g&&g.value.length;const r=null!==u?c.concat(u):c;l[2](...r),d.semanticValue=t,u&&(d.loc=undefined)}const h=i[i.length-1],f=l[0];i.push(d,o[h][f])}else if("acc"===m){i.pop();let e=i.pop();return(1!==i.length||0!==i[0]||l.hasMoreTokens())&&(r.options=u,h(p)),e.hasOwnProperty("semanticValue")?(r.options=u,d.onParseEnd(e.semanticValue),e.semanticValue):(r.options=u,!0)}}while(l.hasMoreTokens()||i.length>1)},setTokenizer:e=>(l=e,d),getTokenizer:()=>l,onParseBegin(e,t,r){},onParseEnd(e){},onShift:e=>e};function h(e){"$"===e.type&&f(),l.throwUnexpectedToken(e.value,e.startLine,e.startColumn)}function f(){!function(e){throw new SyntaxError(e)}("Unexpected end of input.")}var p=d;function g(){const e=document.createElement("div");return e.setAttribute("contenteditable","PLAINTEXT-ONLY"),"plaintext-only"===e.contentEditable}function m(e){switch(e[0]){case"id":return e[1];case"val":switch(typeof e[1]){case"string":return`${e[2]}${e[1]}${e[2]}`;case"number":return e[1];case"boolean":return e[1]?"true":"false";case"object":return null===e[1]?"null":`[${e[1].map(m).join(", ")}]`}case"access":return e[1].map(m).join(".");case"method":return e[1][1].length?`${m(e[1][0])}(${e[1][1].map(m).join(", ")})`:m(e[1][0]);case"subscript":return`${m(e[1][0])}[${m(e[1][1])}]`}return""}function _(e){return e.map((e=>e.replace(/^\s{1,2}/g,"")))}var y={data:()=>({error:null,styledHtml:null,observer:null,plaintextOnlySupport:g()}),props:{value:{default:{literal:"",clean:""},type:Object}},watch:{value(e){e&&e.literal&&(this.parse(e.literal||""),this.$refs.editor.innerText!==e.literal&&this.setText(e.literal))}},mounted(){const e=new ResizeObserver((([e])=>{if(this.$refs.container){const t=e.borderBoxSize[0].blockSize;this.$refs.container.style.height=`${t}px`}}));e.observe(this.$refs.editor),this.observer=e,this.value&&(this.setText(this.value.literal||""),this.parse(this.value.literal))},beforeDestroy(){this.observer.disconnect()},computed:{query(){return this.ast?m(this.ast):""}},methods:{select(e,t){const r=document.createRange();r.setStart(this.$refs.editor.firstChild,e),r.setEnd(this.$refs.editor.firstChild,t||e);const n=window.getSelection();n.removeAllRanges(),n.addRange(r)},setText(e,t,r){this.$refs.editor.innerHTML="",this.$refs.editor.appendChild(document.createTextNode(e)),t&&this.select(t,r)},tabPress(e){const t=window.getSelection().getRangeAt(0),r=Array.from(this.$refs.editor.childNodes).filter((e=>e.nodeType===Node.TEXT_NODE)),n=this.$refs.editor.textContent.split("\n"),s=t.startContainer.nodeType===Node.TEXT_NODE?r.slice(0,r.indexOf(t.startContainer)):[],o=t.startContainer.textContent.substr(0,t.startOffset),i=s.map((e=>e.textContent)).join("")+o,l=t.toString(),a=i.split("\n").length-1;let c=(i+l).split("\n").length;const u=n.slice(a,c);let d=i.split("\n").slice(-1)[0].length,h=(i+l).split("\n").slice(-1)[0].length;if(0===h&&u.length>1&&(u.pop(),h=u[u.length-1].length,c-=1),1===u.length&&u[0].length>l.length||0===u[0].length)if(e.shiftKey){const e=_(u)[0],t=e.length-n[a].length;n[a]=e,d+=t,h+=t}else n[a]=n[a].substr(0,d)+"  "+n[a].substr(h),d+=2,h=d;else{const t=e.shiftKey?_(u):function(e){return e.map((e=>"  "+e))}(u),r=t[0].length-u[0].length,s=t[t.length-1].length-u[u.length-1].length;n.splice(a,t.length,...t),1===u.length?d=0:(d+=r,d=Math.max(d,0)),h+=s}const f=n.slice(0,a).join("\n").length+1+d,p=n.slice(0,c-1).join("\n").length+1+h,g=n.join("\n");this.setText(g,f,p),this.onInput(g)},enterPress(e){const t=window.getSelection().getRangeAt(0),r=Array.from(this.$refs.editor.childNodes).filter((e=>e.nodeType===Node.TEXT_NODE)),n=t.startContainer.nodeType===Node.TEXT_NODE?r.slice(0,r.indexOf(t.startContainer)):[],s=t.startContainer.textContent.substr(0,t.startOffset),o=t.endContainer.nodeType===Node.TEXT_NODE?r.slice(r.indexOf(t.endContainer)+1):[],i=t.endContainer.textContent.substr(t.endOffset),l=n.map((e=>e.textContent)).join("")+s,a=i+o.map((e=>e.textContent)).join(""),c=l.split("\n").pop().match(/^\s*/)[0].length,u="\n"+new Array(c+1).join(" "),d=l+u+(a.endsWith("\n")?a:a+"\n");console.log(u.length),this.setText(d,l.length+u.length),this.onInput(d)},focus(){this.select(this.$refs.editor.firstChild.length)},parse(e){const t=document.createDocumentFragment();if(this.$refs.styled.innerHTML="",!e.trim())return this.error=null,{literal:"",clean:""};{let r=0;try{p.onShift=n=>{n.startOffset>r&&t.appendChild(document.createTextNode(e.slice(r,n.startOffset)));const s=document.createElement("span");return s.appendChild(document.createTextNode(e.slice(n.startOffset,n.endOffset))),s.className="color-"+n.type.toLocaleLowerCase(),t.appendChild(s),r=n.endOffset,n};const n=p.parse(e,{captureLocations:!0});return this.error=null,this.$refs.styled.appendChild(t),{literal:e,clean:m(n)}}catch(n){return this.ast=null,t.appendChild(document.createTextNode(e.slice(r))),this.$refs.styled.appendChild(t),this.error=n,{literal:e,clean:""}}}},onInput(e){this.$nextTick((()=>{this.$emit("input",this.parse(e))}))}}};function T(e,t,r,n,s,o,i,l,a,c){"boolean"!=typeof i&&(a=l,l=i,i=!1);const u="function"==typeof r?r.options:r;let d;if(e&&e.render&&(u.render=e.render,u.staticRenderFns=e.staticRenderFns,u._compiled=!0,s&&(u.functional=!0)),n&&(u._scopeId=n),o?(d=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),t&&t.call(this,a(e)),e&&e._registeredComponents&&e._registeredComponents.add(o)},u._ssrRegister=d):t&&(d=i?function(e){t.call(this,c(e,this.$root.$options.shadowRoot))}:function(e){t.call(this,l(e))}),d)if(u.functional){const e=u.render;u.render=function(t,r){return d.call(r),e(t,r)}}else{const e=u.beforeCreate;u.beforeCreate=e?[].concat(e,d):[d]}return r}const v="undefined"!=typeof navigator&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase());function C(e){return(e,t)=>function(e,t){const r=v?t.media||"default":e,n=b[r]||(b[r]={ids:new Set,styles:[]});if(!n.ids.has(e)){n.ids.add(e);let r=t.source;if(t.map&&(r+="\n/*# sourceURL="+t.map.sources[0]+" */",r+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(t.map))))+" */"),n.element||(n.element=document.createElement("style"),n.element.type="text/css",t.media&&n.element.setAttribute("media",t.media),void 0===k&&(k=document.head||document.getElementsByTagName("head")[0]),k.appendChild(n.element)),"styleSheet"in n.element)n.styles.push(r),n.element.styleSheet.cssText=n.styles.filter(Boolean).join("\n");else{const e=n.ids.size-1,t=document.createTextNode(r),s=n.element.childNodes;s[e]&&n.element.removeChild(s[e]),s.length?n.element.insertBefore(t,s[e]):n.element.appendChild(t)}}}(e,t)}let k;const b={};const O=T({render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("k-field",e._b({staticClass:"query-field"},"k-field",e.$attrs,!1),[r("div",{ref:"container",staticClass:"container"},[r("pre",{ref:"editor",staticClass:"editor",attrs:{spellcheck:"false",contenteditable:e.plaintextOnlySupport?"plaintext-only":"true"},on:{input:function(t){return e.onInput(t.target.innerText)},keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"tab",9,t.key,"Tab")?null:(t.preventDefault(),e.tabPress.apply(null,arguments))},keypress:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:(t.preventDefault(),e.enterPress.apply(null,arguments))}}}),e._v(" "),r("pre",{ref:"styled",staticClass:"styled"})]),e._v(" "),e.error&&e.value?r("pre",{staticClass:"error",domProps:{innerHTML:e._s(e.error)}}):e._e()])},staticRenderFns:[]},(function(e){e&&e("data-v-11ac42b4_0",{source:".query-field .container{position:relative;background:var(--color-background);overflow-x:auto;overflow-y:hidden}.query-field .container>*{padding:1rem}.query-field .error{color:var(--color-negative);margin-top:.5rem}.query-field .editor{color:transparent;caret-color:var(--color-base);min-height:3rem;outline:0}.query-field .editor::selection{color:transparent;background:var(--color-selection-bg)}.query-field .styled{position:absolute;left:0;top:0;width:100%;height:100%;color:var(--color-base);font-family:monospace;pointer-events:none;min-height:3rem}.query-field span.color-identifier{color:var(--color-identifier)}.query-field span.color-string1{color:var(--color-string1)}.query-field span.color-string2{color:var(--color-string2)}.query-field span.color-float{color:var(--color-num)}.query-field span.color-int{color:var(--color-num)}.query-field span.color-true{color:var(--color-bool)}.query-field span.color-false{color:var(--color-bool)}.query-field span.color-dot{color:var(--color-dot)}.query-field span.color-null{color:var(--color-null)}.query-field span.color-lparen,.query-field span.color-rparen{color:var(--color-round-brackets)}.query-field span.color-lbracket,.query-field span.color-rbracket{color:var(--color-square-brackets)}.query-field{--color-background:#333;--color-base:#eee;--color-identifier:#7e9abf;--color-string1:#de935f;--color-string2:#de935f;--color-bool:#a7bd68;--color-num:#a7bd68;--color-null:#a7bd68;--color-selection-bg:rgba(244,244,244,0.2)}",map:void 0,media:void 0})}),y,undefined,false,undefined,!1,C,void 0,void 0);const E=T({render:function(){var e=this,t=e.$createElement;return(e._self._c||t)("pre",{staticClass:"k-structure-table-text"},[e._v(e._s(e.value.clean))])},staticRenderFns:[]},undefined,{props:{value:String,column:Object,field:Object}},undefined,false,undefined,!1,void 0,void 0,void 0);panel.plugin("rasteiner/k3-query-field",{fields:{query:O},components:{"k-query-field-preview":E}})}();
